
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Lab 2: Capturing Signals and Displaying Signals &#8212; ECE447 Course Webpage</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'labs/Lab2';</script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Lab 3: Scanning for Signals, Modulation, and Decimation" href="Lab3.html" />
    <link rel="prev" title="Lab 1: Installing SDR Receivers" href="Lab1.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="ECE447 Course Webpage - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="ECE447 Course Webpage - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to ECE447, Communication Systems!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Info</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../schedule.html">Course Schedule</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Course Downloads</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../downloads.html">Slides and Downloads</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Assignments and Labs</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../SkillsReview.html">Skills Review</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab1.html">Lab 1: Installing SDR Receivers</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Lab 2: Capturing Signals and Displaying Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab3.html">Lab 3: Scanning for Signals, Modulation, and Decimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab4.html">Lab 4: Narrowband FM</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab5.html">Lab 5: Commercial FM</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab6.html">Lab 6: A Few Different Digital Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab7.html">Lab 7: Automatic Dependent Surveillance-Broadcast (ADS-B)</a></li>
<li class="toctree-l1"><a class="reference internal" href="Lab8.html">Lab 8: Digital Packet Radio – APRS</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/usafa-ece/jupyterbook-template" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/usafa-ece/jupyterbook-template/issues/new?title=Issue%20on%20page%20%2Flabs/Lab2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/labs/Lab2.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Lab 2: Capturing Signals and Displaying Signals</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims-of-the-lab">Aims of the Lab</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#command-line-sdr-control">Command Line SDR Control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rtl-test"><strong>rtl_test</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rtl-sdr"><strong>rtl_sdr</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#airband-am-signals">Airband AM Signals</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="lab-2-capturing-signals-and-displaying-signals">
<h1>Lab 2: Capturing Signals and Displaying Signals<a class="headerlink" href="#lab-2-capturing-signals-and-displaying-signals" title="Link to this heading">#</a></h1>
<p>(Adapted from Dr. John Pauly’s Stanford University EE179 course website: <a class="reference external" href="https://web.stanford.edu/class/ee179/Homework.html.">https://web.stanford.edu/class/ee179/Homework.html.</a>)</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading">#</a></h2>
<p>Last time you used an integrated program, gqrx or SDR#, to control your SDR and listen to sideband commercial FM and narrowband FM used in police and fire radio. This week we’ll get a little closer to the hardware and learn how to control the SDRs more directly. We’ll use this to save data to a file, or stream it over a socket, so we can get signals into MATLAB where we can get a better look at them.</p>
</section>
<section id="aims-of-the-lab">
<h2>Aims of the Lab<a class="headerlink" href="#aims-of-the-lab" title="Link to this heading">#</a></h2>
<p>This week we’ll look at other ways to control your SDR, how to get the data into MATLAB, and then display the spectrum. In the end you will be able to capture a signal, and display it’s spectrum as a plot, and a spectrogram which displays how the spectrum changes with time.</p>
</section>
<section id="command-line-sdr-control">
<h2>Command Line SDR Control<a class="headerlink" href="#command-line-sdr-control" title="Link to this heading">#</a></h2>
<p>You can control your SDR more directly with programs you run from the command line. This will allow you to see details about the SDR, capture data to a file, or stream it over the network via a socket.</p>
<p>If you have a mac, the programs used to be installed when you installed gqrx. However the latest version doesn’t. The easiest thing to do is install an older version that includes these. This is at</p>
<p><a class="reference external" href="https://github.com/gqrx-sdr/gqrx/releases/tag/v2.11.5">gqrx with rtl utilities</a></p>
<p>Just make sure to give it a unique name so you don’t write over the latest version of gqrx.</p>
<p>They are stored in the directory that is the application. Open a terminal, and cd to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">Applications</span><span class="o">/</span><span class="n">Gqrx_2</span><span class="mf">.11.5</span><span class="o">.</span><span class="n">app</span><span class="o">/</span><span class="n">Contents</span><span class="o">/</span><span class="n">MacOS</span><span class="o">/.</span>
</pre></div>
</div>
<p>Here I assume you named the old version Gqrx_2.11.5. This has several programs, including three that you will be using in this lab. These are rtl_test, rtl_sdr, and rtl_tcp.</p>
<p>Either add the directory where these programs reside to your path, or make symbolic links to them, so that you can run them conveniently.</p>
<p>You can also build these using Homebrew or Macports.</p>
<p>If you are using Windows you can download and install the executables directly from Osmocom, the company that supports all of these projects. The link to the general page is</p>
<p><a class="reference external" href="https://osmocom.org/projects/rtl-sdr/wiki/Rtl-sdr">Osmocom rtlsdr page</a></p>
<p>and a link to the compiled binaries is</p>
<p><a class="reference external" href="https://ftp.osmocom.org/binaries/windows/rtl-sdr/">Executables for the rtlsdr utilities</a></p>
<p>Choose the latest version compatible with your system.</p>
<p>For Linux you can install gqrx using the apt manager, and this will automatically install all of gnuradio and the rtl utilities.</p>
<section id="rtl-test">
<h3><strong>rtl_test</strong><a class="headerlink" href="#rtl-test" title="Link to this heading">#</a></h3>
<p>The first program we’ll look at is rtl_test. This looks for the SDR and reports what it finds. This is the first program to use when debugging your SDR.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; .\rtl_test
Found 1 device(s):
  0:  ezcap USB 2.0 DVB-T/DAB/FM dongle

Using device 0: ezcap USB 2.0 DVB-T/DAB/FM dongle
Found Rafael Micro R820T tuner
Supported gain values (29): 0.0 0.9 1.4 2.7 3.7 7.7 8.7 12.5 14.4 15.7
16.6 19.7 20.7 22.9 25.4 28.0 29.7 32.8 33.8 36.4 37.2 38.6 40.2 42.1
43.4 43.9 44.5 48.0 49.6

Info: This tool will continuously read from the device, and report if
samples get lost. If you observe no further output, everything is fine.

Reading samples in async mode...
^CSignal caught, exiting!

User cancel, exiting...
</pre></div>
</div>
<p>This runs continuously to test the data rate, until you stop it with a ^C. There are a number of options, which are listed below.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>[-s samplerate (default: 2048000 Hz)]
[-d device_index (default: 0)]
[-t enable Elonics E4000 tuner benchmark]
[-p enable PPM error measurement]
[-b output_block_size (default: 16 * 16384)]
[-S force sync output (default: async)]
</pre></div>
</div>
<p>You can set the sampling rate with the “-s” option, which defaults to 2.048 MHz. One interesting option is “-p”, which tests what the actual sampling rate is. This will be slightly off of what you’ve asked for, and is the reason that the peaks in the spectra aren’t exactly where they should be when you use gqrx or SDR#. This changes as the device heats up. This is what I get after about a minute or so</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt; rtl_test -p
Found 1 device(s):
  0:  ezcap USB 2.0 DVB-T/DAB/FM dongle

Using device 0: ezcap USB 2.0 DVB-T/DAB/FM dongle
Found Rafael Micro R820T tuner
Supported gain values (29): 0.0 0.9 1.4 2.7 3.7 7.7 8.7 12.5 14.4 15.7
16.6 19.7 20.7 22.9 25.4 28.0 29.7 32.8 33.8 36.4 37.2 38.6 40.2 42.1
43.4 43.9 44.5 48.0 49.6
Reporting PPM error measurement every 10 seconds...
Press ^C after a few minutes.
Reading samples in async mode...
real sample rate: 2047990
real sample rate: 2047837
real sample rate: 2047994
real sample rate: 2047987
real sample rate: 2047892
real sample rate: 2047993
^CSignal caught, exiting!

User cancel, exiting...
Cumulative PPM error: -27
</pre></div>
</div>
<p>This shows that my sampling rate is off by -27 parts per million, or ppm. You can set a correction for this in gqrx or SDR#.</p>
</section>
<section id="rtl-sdr">
<h3><strong>rtl_sdr</strong><a class="headerlink" href="#rtl-sdr" title="Link to this heading">#</a></h3>
<p>The next program is rtl_sdr. This starts the SDR up, then collects data, and writes it to a file. This also has a number of options</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">rtl_sdr</span>
<span class="n">rtl_sdr</span><span class="p">,</span> <span class="n">an</span> <span class="n">I</span><span class="o">/</span><span class="n">Q</span> <span class="n">recorder</span> <span class="k">for</span> <span class="n">RTL2832</span> <span class="n">based</span> <span class="n">DVB</span><span class="o">-</span><span class="n">T</span> <span class="n">receivers</span>

<span class="n">Usage</span><span class="p">:</span>	 <span class="o">-</span><span class="n">f</span> <span class="n">frequency_to_tune_to</span> <span class="p">[</span><span class="n">Hz</span><span class="p">]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">s</span> <span class="n">samplerate</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">2048000</span> <span class="n">Hz</span><span class="p">)]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">d</span> <span class="n">device_index</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">)]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">g</span> <span class="n">gain</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">auto</span><span class="p">)]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">b</span> <span class="n">output_block_size</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">16384</span><span class="p">)]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">n</span> <span class="n">number</span> <span class="n">of</span> <span class="n">samples</span> <span class="n">to</span> <span class="n">read</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">infinite</span><span class="p">)]</span>
	<span class="p">[</span><span class="o">-</span><span class="n">S</span> <span class="n">force</span> <span class="n">sync</span> <span class="n">output</span> <span class="p">(</span><span class="n">default</span><span class="p">:</span> <span class="k">async</span><span class="p">)]</span>
	<span class="n">filename</span> <span class="p">(</span><span class="n">a</span> <span class="s1">&#39;-&#39;</span> <span class="n">dumps</span> <span class="n">samples</span> <span class="n">to</span> <span class="n">stdout</span><span class="p">)</span>
</pre></div>
</div>
<p>You set the center frequency with the “-f” switch, specified in Hz (you will get a lot of practice counting zeros!). The “-g” switch sets the gain in dB. You can set it to anything, but you’ll get the closest value from the list of supported gains that you saw with rtl_test. For example to collect 10 seconds of data centered at 120 MHz (the AM air band used for air traffic control), you would run</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="o">./</span><span class="n">rtl_sdr</span> <span class="o">-</span><span class="n">f</span> <span class="mi">120000000</span> <span class="o">-</span><span class="n">g</span> <span class="mi">40</span> <span class="o">-</span><span class="n">n</span> <span class="mi">20480000</span> <span class="n">ab120_10s</span><span class="o">.</span><span class="n">dat</span>
<span class="n">Found</span> <span class="mi">1</span> <span class="n">device</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
  <span class="mi">0</span><span class="p">:</span>  <span class="n">Realtek</span><span class="p">,</span> <span class="n">RTL2838UHIDIR</span><span class="p">,</span> <span class="n">SN</span><span class="p">:</span> <span class="mi">00000001</span>

<span class="n">Using</span> <span class="n">device</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ezcap</span> <span class="n">USB</span> <span class="mf">2.0</span> <span class="n">DVB</span><span class="o">-</span><span class="n">T</span><span class="o">/</span><span class="n">DAB</span><span class="o">/</span><span class="n">FM</span> <span class="n">dongle</span>
<span class="n">Found</span> <span class="n">Rafael</span> <span class="n">Micro</span> <span class="n">R820T</span> <span class="n">tuner</span>
<span class="n">Tuned</span> <span class="n">to</span> <span class="mi">120000000</span> <span class="n">Hz</span><span class="o">.</span>
<span class="n">Tuner</span> <span class="n">gain</span> <span class="nb">set</span> <span class="n">to</span> <span class="mf">40.000000</span> <span class="n">dB</span><span class="o">.</span>
<span class="n">Reading</span> <span class="n">samples</span> <span class="ow">in</span> <span class="k">async</span> <span class="n">mode</span><span class="o">...</span>

<span class="n">User</span> <span class="n">cancel</span><span class="p">,</span> <span class="n">exiting</span><span class="o">...</span>
</pre></div>
</div>
<p>The program terminates by itself when it has collected enough data.</p>
<p>Once we’ve saved the data to a file, we can load it into MATLAB. The m-file</p>
<p><a class="reference download internal" download="" href="../_downloads/619e02bb36032f6e1aa142c28185a6ef/loadFile.m"><span class="xref download myst">loadFile.m</span></a></p>
<p>will do this for you. It looks like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">function</span> <span class="n">y</span> <span class="o">=</span> <span class="n">loadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="o">%</span>  <span class="n">y</span> <span class="o">=</span> <span class="n">loadFile</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="o">%</span>
<span class="o">%</span> <span class="n">reads</span>  <span class="nb">complex</span> <span class="n">samples</span> <span class="kn">from</span><span class="w"> </span><span class="nn">the</span> <span class="n">rtlsdr</span> <span class="n">file</span>
<span class="o">%</span>

<span class="n">fid</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">);</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">fid</span><span class="p">,</span><span class="s1">&#39;uint8=&gt;double&#39;</span><span class="p">);</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="mi">127</span><span class="p">;</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">y</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="mi">2</span><span class="p">:</span><span class="n">end</span><span class="p">);</span>
</pre></div>
</div>
<p>This loads the signed sequence of byte I and Q values, and stores them as complex MATLAB vector.</p>
</section>
</section>
<section id="airband-am-signals">
<h2>Airband AM Signals<a class="headerlink" href="#airband-am-signals" title="Link to this heading">#</a></h2>
<p>The main part of the lab is to capture and decode AM signals in the air band, with is right above the commercial FM band we were decoding last week. There is a band from 108-118 MHz that mostly has navigation beacons that identify themselves by Morse code. Then from 118-137 MHz there are several bands used for communication between aircraft and the ground. Communications in these bands uses AM modulation. This is because when two users try to talk on the same channel, you hear both of them with AM. With FM, you hear only the stronger of the two, or something completely intelligible if both are the same strength. With air traffic control, it is important to hear everyone that is out there!</p>
<p>The USAFA Airfield transmits on these frequencies</p>
<p><img alt="" src="../_images/USAFA_Airfield.png" /></p>
<p>We can also hear traffic from the Colorado Springs Airport and Peterson SFB. Since both use the same runways, they both use the same International Air Transport Association (IATA) code of COS. However, they do not use all of the same radio frequencies. For the main civilian airport, the frequencies are</p>
<p><img alt="" src="../_images/COS.png" /></p>
<p>The military side also has</p>
<p><img alt="" src="../_images/COS_Peterson.png" /></p>
<p>Choose a frequency where you might expect to get a signal. The ATIS frequencies are good initial candidates, because these continuously transmit information about the airport and how to contact them. The other frequencies, such at the air traffic control frequencies, are more interesting but are not always in use. Often a transmission lasts just a few seconds and can be hard to capture.</p>
<p>(Find busy channel in area) One busy channel that has a strong signal around here is 310.8 MHz, SFO departures and arrivals from the south. This frequency also is a good match for your SDR antenna. At 310.8 MHz a quarter wave antenna is 24 cm, or about 9.5 inches. Stick your antenna to a metal surface to provide a ground plane, and extend the antenna to this length. Small adjustments to the frequency can help (+/- a few kHz).</p>
<p>Use gqrx or SDR# to see if you can find any activity. Here is an example</p>
<p>You see a couple of frequencies in use. The one that is on continuously is an ATIS signal. The others are planes and towers talking to each other. Note the gain you use here, so you can set it to be the same for your capture.</p>
<p>Once you know there is a signal out there, capture 10 seconds of data, and save it to a file. Close gqrx or SDR# to free up the SDR, and then capture the data with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;</span> <span class="n">rtl_sdr</span> <span class="o">-</span><span class="n">f</span> <span class="mi">135000000</span> <span class="o">-</span><span class="n">n</span> <span class="mi">20480000</span> <span class="n">ab</span><span class="o">.</span><span class="n">dat</span>
</pre></div>
</div>
<p>where I have chosen 135.0 MHz. You will probably want to set it to something else. Don’t set the frequency exactly to the frequency you want to acquire, because the receiver produces an artifact at DC. This is the spike you always see at the middle of the spectrum.</p>
<p>A sample file is available at</p>
<p><a class="reference internal" href="#ab1355_10s.dat"><span class="xref myst">ab1355_10s.dat</span></a></p>
<p>You can use this file if you are having trouble finding signals to capture. It is sampled at 2.048 MHz, and is centered at 135.5 MHz. The Palo Alto ATIS signal is there, as well as one of the NORCAL approach signals</p>
<p>Once you have the data, we will load it into MATLAB to look at it. Start up MATLAB, and change to the directory where loadFile.m and the data file are. Load the data file with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">loadFile</span><span class="p">(</span><span class="s1">&#39;ab.dat&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The first thing to note is that just 10 seconds of RF is a lot of data! It is hard to tell if we have anything, or how to extract it. What we will do is make something like the waterfall plot that you see in gqrx or SDR#, called a spectrogram. What this does is compute the spectrum of blocks of the signal, and displays an image of how this changes over time. A basic spectrogram program is provided here</p>
<p><a class="reference internal" href="#msg.m"><span class="xref myst">msg.m</span></a></p>
<p>It is msg.m for “my spectrogram”. We will improve this as the course goes on. The help information is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">help</span> <span class="n">msg</span>

  <span class="n">msg</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n0</span><span class="p">,</span><span class="n">nf</span><span class="p">,</span><span class="n">nt</span><span class="p">,</span><span class="n">dbf</span><span class="p">)</span>

   <span class="n">Computes</span> <span class="ow">and</span> <span class="n">displays</span> <span class="n">a</span> <span class="n">spectrogram</span>

       <span class="n">x</span>  <span class="o">--</span> <span class="nb">input</span> <span class="n">signal</span>
       <span class="n">n0</span> <span class="o">--</span> <span class="n">first</span> <span class="n">sample</span>
       <span class="n">nf</span> <span class="o">--</span> <span class="n">block</span> <span class="n">size</span> <span class="k">for</span> <span class="n">transform</span>
       <span class="n">nt</span> <span class="o">--</span> <span class="n">number</span> <span class="n">of</span> <span class="n">time</span> <span class="n">steps</span> <span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
       <span class="n">dbf</span> <span class="o">--</span> <span class="n">dynamic</span> <span class="nb">range</span> <span class="ow">in</span> <span class="n">dB</span> <span class="p">(</span><span class="n">default</span> <span class="mi">40</span><span class="p">)</span>

   <span class="n">This</span> <span class="n">extracts</span> <span class="n">a</span> <span class="n">segment</span> <span class="n">of</span> <span class="n">x</span> <span class="n">starting</span> <span class="n">at</span> <span class="n">n0</span><span class="p">,</span> <span class="n">of</span> <span class="n">length</span> <span class="n">nf</span><span class="o">*</span><span class="n">nt</span>
   <span class="n">The</span> <span class="n">image</span> <span class="n">plot</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">dB</span><span class="p">,</span> <span class="ow">and</span> <span class="n">autoscaled</span><span class="o">.</span>  <span class="n">This</span> <span class="n">can</span> <span class="n">look</span> <span class="n">very</span> <span class="n">noisy</span>
   <span class="k">if</span> <span class="n">there</span> <span class="n">aren</span><span class="s1">&#39;t any interesting signals present.</span>
</pre></div>
</div>
<p>This takes an input signal starting at sample n0, and computes the spectrum of nt segments of the signal, each of length nf. The result is displayed as an image, with time going horizontally, and frequency vertically. The center frequency is in the middle of the plot. For example, for the data provided above, we can look at the first second of data, by looking at 2000 blocks each of length 1024 samples (2048000 total samples, or one second at the 2.048 sampling rate). The results is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">loadFile</span><span class="p">(</span><span class="s1">&#39;ab1335_10s.dat&#39;</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">msg</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
</pre></div>
</div>
<p>Unless you have a very big display, you’ll get an error message that the image doesn’t fit, and was scaled down. The result looks like this</p>
<p><img alt="" src="../_images/COS_Peterson.png" /></p>
<p>We see several signals. The msg.m file will return the data that is plotted if you assign the output to a variable</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">msg</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1024</span><span class="p">,</span><span class="mi">2000</span><span class="p">);</span>
</pre></div>
</div>
<p>We can plot the spectrum at at time of 0.5 seconds by plotting column 1000,</p>
<p>By zooming in, you can see that there is a strong signal at sample 313. You can plot that signal by plotting a row of the data</p>
<p>What you see is a conventional AM signal. The transmitted signal is a constant bias plus the voice signal being transmitted.</p>
<p>For your assignment, find an AM signal in the data you captured, and email me a screen shot of a plot of the signal. Or, if you are using the data set provided, find another signal, and send a plot of it (there are at least two more). You have ten seconds of data, so you can look later in the signal by increasing n0. For example, to start at 5 seconds, n0 should be 5*2048000.</p>
<p>You can also use msg.m to decode the signals. Each column in the image is a sample of the spectrum in time. If we want to sample at 8kHz, we need blocks that are 2048000/8000 = 256 samples. In this case the entire data set is 80,000 samples. You may want to comment out the imshow line, and then do</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">dd</span> <span class="o">=</span> <span class="n">msg</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">80000</span><span class="p">);</span>
</pre></div>
</div>
<p>Find the row in dd that corresponds to your signal, take the absolute value, scale it to a maximum amplitude of one, and then play it through your sound card. You should hear the audio.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">dx</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dd</span><span class="p">(</span><span class="n">N</span><span class="p">,:))</span>
<span class="o">&gt;&gt;</span> <span class="n">dx</span> <span class="o">=</span> <span class="n">dx</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">dx</span><span class="p">);</span>
<span class="o">&gt;&gt;</span> <span class="n">sound</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="mi">8000</span><span class="p">);</span>
</pre></div>
</div>
<p>Next time we’ll look at better ways to do this using modulation and decimation.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./labs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Lab1.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Lab 1: Installing SDR Receivers</p>
      </div>
    </a>
    <a class="right-next"
       href="Lab3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Lab 3: Scanning for Signals, Modulation, and Decimation</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aims-of-the-lab">Aims of the Lab</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#command-line-sdr-control">Command Line SDR Control</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rtl-test"><strong>rtl_test</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rtl-sdr"><strong>rtl_sdr</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#airband-am-signals">Airband AM Signals</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By DFEC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>